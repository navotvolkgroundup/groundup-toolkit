#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCRIPT="$SCRIPT_DIR/reminders.py"

# Safe .env loading (no shell execution)
if [ -f "$HOME/.env" ]; then
    while IFS='=' read -r key value; do
        [[ -z "$key" || "$key" =~ ^[[:space:]]*# ]] && continue
        key=$(echo "$key" | xargs)
        [[ "$key" =~ ^[A-Za-z_][A-Za-z_0-9]*$ ]] && export "$key=$value"
    done < "$HOME/.env"
fi

# Parse action
ACTION="${1:-reminders}"

case "$ACTION" in
    reminders)
        # Normal reminder processing
        /usr/bin/python3 "$SCRIPT"
        ;;

    next-meeting)
        # Query next meeting by email or phone
        IDENTIFIER="${2:-}"
        if [ -z "$IDENTIFIER" ]; then
            echo "Usage: meeting-reminders next-meeting <email|phone>"
            exit 1
        fi

        /usr/bin/python3 "$SCRIPT" query "$IDENTIFIER"
        ;;

    *)
        echo "Usage: meeting-reminders [reminders|next-meeting <email|phone>]"
        exit 1
        ;;
esac
