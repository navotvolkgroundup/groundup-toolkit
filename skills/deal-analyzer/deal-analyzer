#!/bin/bash

SCRIPT_DIR="$(cd "$(dirname "${BASH_SOURCE[0]}")" && pwd)"
SCRIPT="$SCRIPT_DIR/analyzer.py"

# Load environment variables
if [ -f "$HOME/.env" ]; then
    . "$HOME/.env"
fi

ACTION="${1:-help}"
shift 2>/dev/null

case "$ACTION" in
    analyze)
        DECK_URL="${1:-}"
        PHONE="${2:-}"
        SENDER_EMAIL="${3:-}"
        if [ -z "$DECK_URL" ]; then
            echo "Usage: deal-analyzer analyze <deck-url> [phone] [sender-email]"
            exit 1
        fi
        /usr/bin/python3 "$SCRIPT" analyze "$DECK_URL" "$PHONE" "$SENDER_EMAIL"
        ;;

    evaluate)
        DECK_URL="${1:-}"
        NOTIFY_PHONE="${2:-}"
        NOTIFY_EMAIL="${3:-}"
        if [ -z "$DECK_URL" ] || [ -z "$NOTIFY_PHONE" ]; then
            echo "Usage: deal-analyzer evaluate <deck-url> <phone> [email]"
            exit 1
        fi
        /usr/bin/python3 "$SCRIPT" evaluate "$DECK_URL" "$NOTIFY_PHONE" "$NOTIFY_EMAIL"
        ;;

    full-report)
        PHONE="${1:-}"
        EMAIL="${2:-}"
        /usr/bin/python3 "$SCRIPT" full-report "$PHONE" "$EMAIL"
        ;;

    log)
        PHONE="${1:-}"
        /usr/bin/python3 "$SCRIPT" log "$PHONE"
        ;;

    demo)
        PHONE="${1:-}"
        EMAIL="${2:-}"
        /usr/bin/python3 "$SCRIPT" demo "$PHONE" "$EMAIL"
        ;;

    end-demo)
        /usr/bin/python3 "$SCRIPT" end-demo
        ;;

    test)
        /usr/bin/python3 "$SCRIPT" test
        ;;

    *)
        echo "Deal Analyzer â€” AI-powered investment evaluation"
        echo ""
        echo "Usage: deal-analyzer <action> [args]"
        echo ""
        echo "Actions:"
        echo "  analyze <URL> [PHONE] [EMAIL]    Quick deck extraction (10s)"
        echo "  evaluate <URL> <PHONE> [EMAIL]   Full 12-section analysis (3-5 min)"
        echo "  full-report [PHONE] [EMAIL]      Full report from last analysis state"
        echo "  log [PHONE]                      Log last analysis to HubSpot"
        echo "  demo <PHONE> [EMAIL]             Activate LP demo mode"
        echo "  end-demo                         Deactivate demo mode"
        echo "  test                             Run test with sample data"
        exit 0
        ;;
esac
